@page "/login"
@layout Shared.BlankLayout
@using CoworkingBlazor.Services
@inject IAuthService AuthService
@inject NavigationManager NavigationManager

<div class="d-flex align-items-center justify-content-center" style="min-height:70vh;">
    <div class="row gx-0 shadow-lg" style="max-width:920px; width:100%; border-radius:16px; overflow:hidden;">
        <div class="col-md-5 d-none d-md-flex align-items-center justify-content-center" style="background:var(--brand-gradient); color:#fff; padding:2.5rem;">
            <div class="text-center" style="max-width:260px;">
                <h2 style="font-weight:800;">Welcome to CoWorking</h2>
                <p class="muted" style="color:rgba(255,255,255,0.95);">Sign in to access your workspace dashboard — manage bookings, subscriptions, and resources.</p>
                <!-- Decorative SVG -->
                <svg width="140" height="140" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="img-rounded mt-3">
                    <rect x="2" y="2" width="20" height="20" rx="4" fill="rgba(255,255,255,0.12)" />
                    <path d="M6 12h12M6 8h12M6 16h12" stroke="rgba(255,255,255,0.9)" stroke-width="1.5" stroke-linecap="round" />
                </svg>
                <div class="mt-4">
                    <span class="badge-soft">Fast • Secure • Reliable</span>
                </div>
            </div>
        </div>

        <div class="col-12 col-md-7 p-4 panel">
            <div class="mb-3 text-center">
                <h3 class="mb-0">Sign in to your account</h3>
                <p class="muted small mt-2">Enter your credentials to continue</p>
            </div>

            <EditForm Model="this" OnValidSubmit="HandleLogin">
                <div class="mb-3">
                    <label class="form-label" for="username">Username</label>
                    <input id="username" class="form-control" @bind="Username" placeholder="Enter username" aria-label="Username" />
                </div>

                <div class="mb-3">
                    <label class="form-label" for="password">Password</label>
                    <input id="password" type="password" class="form-control" @bind="Password" placeholder="Enter password" aria-label="Password" />
                </div>

                @if (!string.IsNullOrEmpty(ErrorMessage))
                {
                    <div class="alert alert-danger" role="alert">
                        @ErrorMessage
                    </div>
                }

                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="remember" />
                        <label class="form-check-label muted" for="remember">Remember me</label>
                    </div>
                    <a class="muted" href="/">Forgot password?</a>
                </div>

                <button type="button" class="btn btn-primary w-100" @onclick="HandleLogin" disabled="@IsLoading">
                    @if (IsLoading)
                    {
                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    }
                    Sign in
                </button>
            </EditForm>

            <div class="text-center mt-4">
                <small class="muted">Don't have an account? <a href="/register">Create one</a></small>
            </div>
        </div>
    </div>
</div>

@code {
    private string Username = string.Empty;
    private string Password = string.Empty;
    private string ErrorMessage = string.Empty;
    private bool IsLoading = false;

    private async Task HandleLogin()
    {
        ErrorMessage = string.Empty;

        if (string.IsNullOrWhiteSpace(Username) || string.IsNullOrWhiteSpace(Password))
        {
            ErrorMessage = "Username and password are required";
            return;
        }

        IsLoading = true;
        try
        {
            bool success = await AuthService.LoginAsync(Username, Password);
            if (success)
            {
                NavigationManager.NavigateTo("/dashboard");
            }
            else
            {
                ErrorMessage = "Invalid username or password";
            }
        }
        catch (Exception ex)
        {
            ErrorMessage = "Login failed. Please try again.";
            Console.WriteLine(ex.Message);
        }
        finally
        {
            IsLoading = false;
        }
    }
}